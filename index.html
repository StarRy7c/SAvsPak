<!DOCTYPE html><html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Willow Live Streaming</title>
<link href="https://cdnjs.cloudflare.com/ajax/libs/shaka-player/4.7.11/controls.min.css" rel="stylesheet">
<style>
  body { margin: 0; font-family: Arial, sans-serif; background: #111; color: #fff; }
  .container { padding: 20px; }
  .match-list { display: flex; flex-wrap: wrap; gap: 20px; }
  .match-card { background: #222; border: 1px solid #333; border-radius: 8px; padding: 10px; width: 200px; cursor: pointer; text-align: center; transition: 0.3s; }
  .match-card:hover { background: #333; }
  .match-card img { width: 100%; height: auto; border-radius: 6px; }
  .match-title { margin-top: 10px; font-size: 16px; }
  .video-container { margin-top: 20px; height: 60vh; position: relative; }
  video { width: 100%; height: 100%; background: black; }
</style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/shaka-player/4.7.11/shaka-player.ui.min.js" defer></script>
</head>
<body>
<div class="container">
  <h1>Willow Live Matches</h1>
  <div class="match-list" id="matchList"></div>
  <div class="video-container">
    <video id="video" autoplay muted controls></video>
  </div>
</div><script>
let player, ui;

// Initialize Shaka Player
async function initPlayer() {
  const video = document.getElementById('video');
  ui = video.ui;
  const controls = ui.getControls();
  player = controls.getPlayer();

  window.player = player;
  window.ui = ui;

  ui.configure({
    controlPanelElements: ['play_pause', 'mute', 'volume', 'spacer', 'time_and_duration', 'picture_in_picture', 'fullscreen', 'overflow_menu'],
  });

  player.addEventListener('error', onPlayerError);
}

function onPlayerError(event) {
  console.error('Error code', event.detail.code, 'object', event.detail);
}

document.addEventListener('shaka-ui-loaded', initPlayer);

// Load Matches from willow.json
async function loadMatches() {
  const response = await fetch('https://raw.githubusercontent.com/drmlive/willow-live-events/main/willow.json');
  const data = await response.json();
  const matchList = document.getElementById('matchList');

  data.matches.forEach((match, index) => {
    const card = document.createElement('div');
    card.className = 'match-card';
    card.innerHTML = `
      <img src="${match.cover}" alt="${match.title}">
      <div class="match-title">${match.title}</div>
    `;
    card.onclick = () => playStream(match.fastly);
    matchList.appendChild(card);
  });
}

// Play selected match
async function playStream(streamUrl) {
  try {
    await player.load(streamUrl);
    console.log('Playing:', streamUrl);
  } catch (e) {
    console.error('Failed to load stream:', e);
  }
}

// Start
loadMatches();
</script></body>
</html>
