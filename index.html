<script>
async function loadMatches() {
  const response = await fetch('https://raw.githubusercontent.com/drmlive/willow-live-events/main/willow.json');
  const data = await response.json();
  const matchList = document.getElementById('matchList');

  const globalKid = data.kid;
  const globalKey = data.key;

  data.matches.forEach((match) => {
    const card = document.createElement('div');
    card.className = 'match-card';
    card.innerHTML = `
      <img src="${match.cover}" alt="${match.title}">
      <div class="match-title">${match.title}</div>
      <div class="link-buttons" id="links-${match.title.replace(/\s+/g, '')}"></div>
    `;

    matchList.appendChild(card);

    const linksDiv = document.getElementById(`links-${match.title.replace(/\s+/g, '')}`);

    if (match.fastly) {
      const btn = createButton('Fastly', match.fastly, globalKid, globalKey);
      linksDiv.appendChild(btn);
    }
    if (match.cloudfront) {
      const btn = createButton('Cloudfront', match.cloudfront, globalKid, globalKey);
      linksDiv.appendChild(btn);
    }
    if (match.backup) {
      const btn = createButton('Backup', match.backup, globalKid, globalKey);
      linksDiv.appendChild(btn);
    }
  });
}

function createButton(name, streamUrl, kid, key) {
  const button = document.createElement('button');
  button.innerText = name;
  button.onclick = () => {
    const encodedStream = encodeURIComponent(streamUrl);
    const finalUrl = `https://starry7c.github.io/Willow-p?url=${encodedStream}&kid=${kid}&key=${key}`;
    window.open(finalUrl, '_blank');
  };
  return button;
}

loadMatches();
</script>
